# 07-通用程序设计

---

- [第45条：将局部变量的作用域最小化](#第45条将局部变量的作用域最小化)
- [第46条：for-each循环优先于传统的for循环](#第46条for-each循环优先于传统的for循环)
- [第47条：了解和使用类库](#第47条了解和使用类库)
- [第48条：如果需要精确答案，请避免使用float和double](#第48条如果需要精确答案请避免使用float和double)
- [第49条：基本类型优先于装箱基本类型](#第49条基本类型优先于装箱基本类型)
- [第50条：如果其他类型更适合，则尽量避免使用字符串](#第50条如果其他类型更适合则尽量避免使用字符串)
- [第51条：当心字符串连接的性能](#第51条当心字符串连接的性能)

---

## 第45条：将局部变量的作用域最小化

1. 在**第一次使用它的地方声明**，过早声明局部变量不仅使它作用域过早扩展，而且结束也过晚
2. 几乎每个**局部变量声明都应该包含一个初始化表达式**，如果没有足够信息进行有意义的初始化就该**推迟**声明
   - `try-catch`相关的特例
   - `for`优于`while`
3. 使方法**小而集中**，如果把两个操作合并到一个方法，与其中一个操作相关的局部变量可能出现在执行另一个操作的代码范围内，为防止这种情况，我们把方法拆成两个，每个方法执行一个操作

## 第46条：for-each循环优先于传统的for循环

`for-each`循环在**简洁性**和**预防Bug**方面有着传统`for`循环无法比拟的优势！

在对多个集合进行嵌套迭代时，`for`容易出错
```Java
enum Suit { CLUB, DIAMOND, HEART, SPADE }
enum Rank { ACE, DEUCE, THREE, FOUR, FIVE, SIX }
Collection<Suit> suits = Arrays.asList(Suit.values());
Collection<Rank> ranks = Arrays.asList(Rank.values());

List<Card> deck = new ArrayList<Card> ();
for (Iterator<Suit> i = suits.iterator(); i.hasNext(); )
	for (Iterator<Rank> j = ranks.iterator(); j.hasNext(); )
		deck.add(new Card(i.next(), j.next()));
```

如果使用`for-each`循环，既没有bug，又简洁
```Java
for (Suit suit: suits)
	for (Rank rank: ranks)
		deck.add(new Card(suit, rank));
```

无法使用`for-each`循环的情况
1. 过滤 - 遍历集合并**删除**选定元素
2. 转换 - 遍历集合并**取代**部分或全部元素值
3. 平行迭代 - 并行地遍历多个集合

## 第47条：了解和使用类库

使用类库的好处
1. 使用标准类库可充分利用前人的专业知识和经验
2. 不必浪费时间为那些与工作**不太相关**的问题提供**特别的解决方案**
3. 类库**性能**往往随时间推移而提高
4. 可使自己的代码**融入主流**，更易读，更易维护，更易被重用

## 第48条：如果需要精确答案，请避免使用float和double

`float`和`double`执行**二进制浮点运算**，在**广泛数值范围提供较为精准的快速近似计算**，**并不精确**！尤其**不适合货币计算**！

想获得精准结果的替代方案
1. `BigDecimal` - 精准，舍入操作可从8种舍入模式择其一，缺点是**使用不方便**和**慢**
2. `int`和`long` - 缺点是**自己处理十进制小数点**

## 第49条：基本类型优先于装箱基本类型

Java**类型系统**由两部分组成：**基本类型**和**引用类型**，每个基本类型对应一个引用类型，称为**装箱基本类型**！

基本类型和装箱基本类型的区别
1. 基本类型只有值，装箱基本类型具有与值不同的**同一性**
2. 基本类型只有功能完备的值，装箱基本类型除此之外还有非功能值`null`
3. 基本类型比装箱基本类型**更节省空间和时间**

装箱基本类型的劣势
1. 用`==`比较两个装箱基本类型时，它会做同一性比较
2. 程序涉及装箱拆箱和基本类型的**混合计算**时，注意拆箱可能抛出`NullPointerException`
3. 程序装箱了基本类型值时会导致**高开销**和不必要的对象创建

装箱基本类型的使用时机
1. 作为**集合**的元素、键和值
2. **泛型**必须使用装箱基本类型作为**参数**

## 第50条：如果其他类型更适合，则尽量避免使用字符串

不应该使用字符串的情形
1. 字符串不适合代替**其他值类型** - 数据从文件、网络进入程序后应该转换为适当的数值类型
2. 字符串不适合代替**枚举**类型
3. 字符串不适合代替**聚集**类型 - 一个实体有多个组件，用一个字符串表示实体通常不合适
4. 字符串不适合代替**能力表** - 设计提供**线程局部变量**，参考`ThreadLocal`

## 第51条：当心字符串连接的性能

字符串不可变，连接两个字符串的时候它们的内容都要被拷贝！连接`n`个字符串而**重复使用字符串连接**操作，时间复杂度为`n`平方级！

解决方案
1. 使用`StringBuilder`
2. 使用字符数组