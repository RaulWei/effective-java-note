# 03-类和接口

---

- [第13条：使类和成员的可访问性最小化](#第13条使类和成员的可访问性最小化)
- [第14条：在公有类中使用访问方法而非公有域](#第14条在公有类中使用访问方法而非公有域)
- [第19条：接口只用于定义类型](#第19条接口只用于定义类型)

---

## 第13条：使类和成员的可访问性最小化

信息隐藏：模块之间只通过API通信，模块不需要知道其他模块内部工作情况！有效解除组成系统的各个模块间的耦合关系，使得模块可以独立开发、测试、优化、使用、理解和修改！

信息隐藏的优势
1. 加快系统开发速度，因为模块可以**并行开发**
2. 有效**调节性能**，通过剖析确定哪些模块影响系统性能，那些模块可进一步优化，不影响其他模块正确性

成员（域、方法、嵌套类、嵌套接口）的四种访问级别
1. 私有`private` - 只有声明该成员的**顶层类内部**才能访问该成员
2. 包级私有`package-private` - __缺省访问级别__，声明该成员的**包内部任何类**都能访问该成员
3. 受保护`protected` - 声明该成员的**包内部任何类**及声明该成员的类的**子类**能访问该成员
4. 公有`public` - 任何地方都能访问该成员

对于**顶层即非嵌套的类和接口**，只有两种访问级别：包级私有和公有！如果声明为包级私有，说明它是包的**实现**的一部分，后续发行版本可对其进行修改、替换或删除！如果声明为公有，说明它是包**导出API**的一部分，有责任**永远**支持它，保持**兼容**！

注意，__如果子类覆盖超类中的某个方法，子类的访问级别不能低于超类的访问级别__！这样可确保**任何使用超类实例的地方都能使用子类实例**！接口的所有方法都**隐含公有**访问级别，因此**接口实现类的所有方法都必须声明为公有**！

注意，**包含公有可变域的类并不是线程安全的**！例外是**公有静态final域暴露常量**，要么包含**基本类型**值，要么包含**指向不可变对象的引用**！如果类具有**公有静态final数组域**，或者**返回**这种域的访问方法，几乎是**错误**的！解决方案是将**公有数组变私有**，**增加公有不可变列表**或者**添加公有方法返回私有数组的备份**！

```Java
private static final Thing[] PRIVATE_VALUES = { ... };
// 1. 增加公有不可变列表
public static final List<Thing> VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));
// 2. 添加公有方法返回数组的备份
public static final vaules() {
	return PRIVATE_VALUES.clone();
}
```

## 第14条：在公有类中使用访问方法而非公有域

1. **公有类**不应该暴露**可变域**，因为其客户端代码遍布各处，将来极难改变内部表示法
2. **公有类**暴露**不可变域**危害较小，事实上也不应该
3. **包级私有**或**私有嵌套**类，直接暴露数据域并没有本质错误

## 第19条：接口只用于定义类型

```Java
// 常量接口
public interface PhysicalConstants {
	static final double AVOGADROS_NUMBER = 6.0221499e23;
	static final double ELECTRON_MASS = 9.10938188e-31;
}
```

常量接口模式是对接口的**不良使用**，是反面典型，不值得效仿！关键原因：如果类实现常量接口，将来版本中类修改了，不需要这些常量了，它还依然必须实现这个接口，以确保**二进制兼容性**！所以说，接口应该只被用来**定义类型**，不应该被用来导出常量！

导出常量合理的方案：使用**不可实例化**的**工具类**配合**静态导入**！

```Java
// 定义常量类
package com.effectivejava.science;
public final class PhysicalConstants {
	private PhysicalConstants() { }
	public static final double AVOGADROS_NUMBER = 6.0221499e23;
	public static final double ELECTRON_MASS = 9.10938188e-31;
}

// 使用
import static com.effectivejava.science.PhysicalConstants.*;
public class Test {
	double atoms(double mols) {
		return mols * AVOGADROS_NUMBER
	}
}
```

